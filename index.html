<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Transformation Task</title>
    <style>
        /* --- OFFLINE CSS (Replaces Tailwind) --- */
        :root {
            --primary: #1e3a8a; /* Blue 900 */
            --primary-light: #2563eb;
            --secondary: #e2e8f0; /* Slate 200 */
            --text-dark: #1e293b;
            --text-light: #64748b;
            --bg-page: #f1f5f9;
            --bg-card: #ffffff;
            --danger: #ef4444;
            --success: #16a34a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-page);
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 600px;
        }

        /* Header */
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 1.25rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-badge {
            background: rgba(255,255,255,0.2);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Content Areas */
        .step-content {
            display: none; /* Hidden by default */
            padding: 40px;
            flex-grow: 1;
            overflow-y: auto;
            animation: fadeIn 0.5s ease-in;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Components */
        .card {
            background: #f8fafc;
            border: 2px solid var(--secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        .btn-primary:hover { background-color: #1e40af; }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--text-dark);
        }
        .btn-secondary:hover { background-color: #cbd5e1; }

        .btn-listen {
            background-color: #eff6ff;
            color: var(--primary-light);
            border-radius: 50px;
            padding: 8px 16px;
            font-size: 0.9rem;
        }
        .btn-listen:hover { background-color: #dbeafe; }
        .btn-listen.playing { background-color: #fef3c7; color: #92400e; }

        /* Diagrams */
        svg { display: block; width: 100%; height: auto; max-height: 300px; }
        .diagram-box {
            background: #fff;
            border: 1px solid var(--secondary);
            border-radius: 8px;
            padding: 10px;
        }

        /* Form Inputs */
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1rem;
            margin-top: 8px;
            box-sizing: border-box; /* Fix padding issues */
        }
        input:focus, textarea:focus {
            outline: 2px solid var(--primary-light);
            border-color: transparent;
        }

        /* Recording Area */
        .recording-area {
            margin-top: 20px;
            border-top: 1px solid var(--secondary);
            padding-top: 20px;
        }
        .rec-box {
            background: #f8fafc;
            border: 1px solid var(--secondary);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .rec-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: var(--danger);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .rec-btn.recording {
            background: #fee2e2;
            color: var(--danger);
            box-shadow: 0 0 0 4px #fee2e2;
        }
        .rec-status {
            font-family: monospace;
            font-weight: bold;
            font-size: 0.9rem;
            color: #94a3b8;
        }
        .rec-timer {
            font-family: monospace;
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* Layout Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        @media (min-width: 768px) {
            .grid-2 { grid-template-columns: 1fr 1fr; }
        }

        /* Footer */
        footer {
            border-top: 1px solid var(--secondary);
            background: #f8fafc;
            padding: 20px;
            display: flex;
            justify-content: space-between;
        }

        /* Utility */
        .text-center { text-align: center; }
        .flex-col { display: flex; flex-direction: column; align-items: center; }
        .mb-4 { margin-bottom: 1rem; }
        .highlight-red { color: #dc2626; font-weight: bold; }
        .highlight-yellow { color: #d97706; font-weight: bold; }
        .highlight-blue { color: #2563eb; font-weight: bold; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-title">
            <div class="step-badge" id="step-badge-icon">âš¡</div>
            <span id="header-text">Energy Transformation</span>
        </div>
        <div style="opacity: 0.8; font-size: 0.9rem;">
            Page <span id="page-num">1</span> of 5
        </div>
    </header>

    <!-- STEP 0: TITLE -->
    <div id="step-0" class="step-content active">
        <div class="flex-col" style="padding-top: 40px;">
            <div style="background: var(--primary); color: white; padding: 20px; border-radius: 50%; margin-bottom: 20px;">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                </svg>
            </div>
            <h1 style="color: var(--primary); margin-bottom: 10px; font-size: 2.5rem;">Speaking Task</h1>
            <h2 style="color: var(--text-light); margin-top: 0;">Science: Energy Forms</h2>
            <p style="max-width: 400px; text-align: center; color: var(--text-light); line-height: 1.6;">
                In this activity, you will listen to a teacher and a student, look at diagrams, and then explain how energy works in a toaster.
            </p>
            <br>
            <button class="btn btn-primary" onclick="goToStep(1)">
                Start Activity &rarr;
            </button>
        </div>
    </div>

    <!-- STEP 1: CONTEXT -->
    <div id="step-1" class="step-content">
        <div class="card" style="background: #eff6ff; border-color: #bfdbfe;">
            <h3 class="highlight-blue">Introduction</h3>
            <p style="line-height: 1.6;">
                Mrs. Greenâ€™s class is learning about energy. They are learning that energy cannot be created or destroyed, but it can <strong>transform</strong> (change) from one form to another.
            </p>
            <button class="btn btn-listen" onclick="speak('Now we are going to talk about a science project. Mrs. Greenâ€™s class is learning about energy. They are learning that energy cannot be created or destroyed, but it can transformâ€”that means changeâ€”from one form to another.')">
                ðŸ”Š Listen to Introduction
            </button>
        </div>

        <div class="grid-2">
            <div class="card" style="display:flex; align-items:center; gap:15px;">
                <div style="background:#fef9c3; padding:10px; border-radius:50%;">âš¡</div>
                <div>
                    <strong>Key Concept</strong><br>
                    <span style="font-size:0.9rem; color: var(--text-light);">Energy changes form.</span>
                </div>
            </div>
            <div class="card" style="display:flex; align-items:center; gap:15px;">
                <div style="background:#fee2e2; padding:10px; border-radius:50%;">ðŸ”¥</div>
                <div>
                    <strong>Key Standard</strong><br>
                    <span style="font-size:0.9rem; color: var(--text-light);">Energy is not destroyed.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- STEP 2: MODEL -->
    <div id="step-2" class="step-content">
        <div class="grid-2">
            <div class="diagram-box">
                <!-- Lamp SVG -->
                <svg viewBox="0 0 400 300">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#dc2626" /></marker>
                    </defs>
                    <rect x="50" y="250" width="300" height="20" fill="#94a3b8" />
                    <path d="M10 260 Q 50 260, 150 250" stroke="#334155" strokeWidth="3" fill="none" />
                    <rect x="0" y="250" width="20" height="20" fill="#cbd5e1" rx="2" />
                    <path d="M130 250 L170 250 L160 200 L140 200 Z" fill="#1e3a8a" />
                    <rect x="145" y="100" width="10" height="100" fill="#1e3a8a" />
                    <path d="M110 100 L190 100 L210 150 L90 150 Z" fill="#fbbf24" opacity="0.8" />
                    <circle cx="150" cy="130" r="15" fill="#fef08a" />
                    <path d="M30 240 L80 240" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead)" />
                    <text x="35" y="230" fill="#dc2626" font-size="12" font-weight="bold">Electrical</text>
                    <path d="M170 110 L220 90" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead)" />
                    <path d="M180 130 L230 140" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead)" />
                    <text x="235" y="100" fill="#dc2626" font-size="12" font-weight="bold">Light & Heat</text>
                </svg>
                <p class="text-center" style="font-size:0.8rem; color:var(--text-light); margin-top:5px;">Figure 1: Desk Lamp</p>
            </div>

            <div>
                <div class="card" style="border-left: 4px solid var(--primary);">
                    <p class="highlight-blue">Teacher asks:</p>
                    <p style="font-style: italic; color: var(--text-light);">"Nina, explain to me step by step how the energy changes in the desk lamp."</p>
                    <button class="btn btn-listen" onclick="speak('Nina, explain to me step by step how the energy changes in the desk lamp.')">ðŸ”Š Listen</button>
                </div>

                <div class="card" style="border-left: 4px solid #d97706; background: #fffbeb;">
                    <p class="highlight-yellow">Nina answers:</p>
                    <p style="font-size:0.95rem;">"First, <span class="highlight-red">electrical energy</span> comes from the outlet... It changes into <span class="highlight-yellow">radiant energy</span> (light) and <span class="highlight-red">thermal energy</span> (heat)."</p>
                    <button class="btn btn-listen" onclick="speak('I can explain. The lamp needs energy to work. First, electrical energy comes from the outlet and travels through the cord. When the electricity reaches the lightbulb, it transforms. It changes into radiant energy, which is light, so we can read. It also changes into thermal energy, because the lightbulb gets hot.')">ðŸ”Š Listen to Nina</button>
                </div>
            </div>
        </div>
    </div>

    <!-- STEP 3: STUDENT TURN -->
    <div id="step-3" class="step-content">
        <div class="card" style="background:#eff6ff; border-color:#bfdbfe; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
            <div>
                <strong class="highlight-blue">Your Task</strong>
                <div style="font-size:0.9rem;">Explain how energy transforms in the toaster.</div>
            </div>
            <button class="btn btn-listen" onclick="speak('Now itâ€™s your turn. Look at the picture of the toaster. Explain to me step by step how the energy transforms in the toaster. Tell me what form it starts as, and what forms it turns into.')">ðŸ”Š Listen to Instructions</button>
        </div>

        <div class="grid-2">
            <div>
                <div class="diagram-box">
                    <!-- Toaster SVG -->
                    <svg viewBox="0 0 400 300">
                        <defs><marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#dc2626" /></marker></defs>
                        <rect x="50" y="250" width="300" height="20" fill="#94a3b8" />
                        <path d="M10 260 Q 50 260, 120 250" stroke="#334155" strokeWidth="3" fill="none" />
                        <rect x="0" y="250" width="20" height="20" fill="#cbd5e1" rx="2" />
                        <rect x="120" y="150" width="160" height="100" rx="10" fill="#94a3b8" stroke="#475569" strokeWidth="2" />
                        <rect x="140" y="150" width="20" height="80" fill="#cbd5e1" opacity="0.5" />
                        <rect x="180" y="150" width="20" height="80" fill="#cbd5e1" opacity="0.5" />
                        <rect x="220" y="150" width="20" height="80" fill="#cbd5e1" opacity="0.5" />
                        <path d="M130 160 L135 240 M150 160 L155 240" stroke="#ef4444" strokeWidth="2" opacity="0.8" />
                        <path d="M250 160 L255 240 M265 160 L270 240" stroke="#ef4444" strokeWidth="2" opacity="0.8" />
                        <path d="M150 110 L210 110 L205 150 L155 150 Z" fill="#d97706" stroke="#b45309" strokeWidth="2" />
                        <path d="M30 240 L80 240" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead2)" />
                        <text x="35" y="230" fill="#dc2626" font-size="12" font-weight="bold">Electrical</text>
                        <path d="M290 180 L340 160" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead2)" />
                        <text x="350" y="160" fill="#dc2626" font-size="18" font-weight="bold">?</text>
                        <path d="M290 220 L340 240" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead2)" />
                        <text x="350" y="250" fill="#dc2626" font-size="18" font-weight="bold">?</text>
                    </svg>
                </div>
                <div class="card" style="margin-top:10px; background:#f1f5f9;">
                    <strong>Guiding Questions:</strong>
                    <ul style="margin:5px 0 0 20px; font-size:0.9rem;">
                        <li>What energy goes IN?</li>
                        <li>How does it change form?</li>
                        <li>What energy comes OUT?</li>
                    </ul>
                </div>
            </div>

            <div>
                <label style="font-size:0.9rem; font-weight:bold;">1. What starts the toaster?</label>
                <input type="text" placeholder="e.g. Electrical energy...">
                
                <br><br>

                <label style="font-size:0.9rem; font-weight:bold;">2. What forms does it turn into?</label>
                <textarea rows="3" placeholder="It changes into..."></textarea>

                <div class="recording-area">
                    <div style="font-size:0.8rem; font-weight:bold; color:var(--text-light); text-transform:uppercase; margin-bottom:5px;">Practice Speaking</div>
                    <div class="rec-box">
                        <button class="rec-btn" id="record-btn" onclick="toggleRecord()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                        <div>
                            <div class="rec-status" id="rec-status">READY TO RECORD</div>
                            <div class="rec-timer" id="rec-timer">0:00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STEP 4: DONE -->
    <div id="step-4" class="step-content">
        <div class="flex-col" style="padding-top:40px;">
            <div style="background:#dcfce7; color:#16a34a; padding:20px; border-radius:50%; margin-bottom:20px;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
            </div>
            <h1>Great Job!</h1>
            <p class="text-center" style="max-width:400px; color:var(--text-light);">
                You have explained how electrical energy transforms into thermal and radiant energy. Remember, energy is never destroyed, it just changes form!
            </p>
            <br>
            <button class="btn btn-secondary" onclick="goToStep(0)">Start Over</button>
        </div>
    </div>

    <footer id="footer-nav">
        <button class="btn btn-secondary" id="btn-back" onclick="changeStep(-1)" disabled>&larr; Back</button>
        <button class="btn btn-primary" id="btn-next" onclick="changeStep(1)">Next &rarr;</button>
    </footer>
</div>

<script>
    // --- VANILLA JAVASCRIPT LOGIC ---
    let currentStep = 0;
    const totalSteps = 5; // 0 to 4
    const titles = ["Energy Task", "The Classroom", "The Model", "Your Turn", "Complete"];

    function goToStep(stepIndex) {
        currentStep = stepIndex;
        updateUI();
    }

    function changeStep(delta) {
        const newStep = currentStep + delta;
        if (newStep >= 0 && newStep < totalSteps) {
            currentStep = newStep;
            updateUI();
        }
    }

    function updateUI() {
        // 1. Hide all steps
        document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
        
        // 2. Show current step
        document.getElementById(`step-${currentStep}`).classList.add('active');

        // 3. Update Header
        document.getElementById('header-text').innerText = titles[currentStep];
        document.getElementById('page-num').innerText = currentStep + 1;
        document.getElementById('step-badge-icon').innerText = currentStep === 0 ? 'âš¡' : currentStep;

        // 4. Update Footer Buttons
        const backBtn = document.getElementById('btn-back');
        const nextBtn = document.getElementById('btn-next');
        const footer = document.getElementById('footer-nav');

        if (currentStep === 0 || currentStep === 4) {
            footer.style.display = 'none'; // Hide nav on start/end screens
        } else {
            footer.style.display = 'flex';
            backBtn.disabled = (currentStep <= 1); // Disable back on first content page
            
            // Logic to disable Next on final page if needed, but we loop to end screen
            if (currentStep === 3) {
                nextBtn.innerHTML = 'Finish &rarr;';
            } else {
                nextBtn.innerHTML = 'Next &rarr;';
            }
        }
    }

    // --- Audio Logic ---
    let isSpeaking = false;
    function speak(text) {
        window.speechSynthesis.cancel(); // Stop previous
        if (isSpeaking) {
            isSpeaking = false;
            return;
        }

        const utterance = new SpeechSynthesisUtterance(text);
        // Try to get a female voice
        const voices = window.speechSynthesis.getVoices();
        const voice = voices.find(v => v.name.includes('Female') || v.name.includes('Google US English'));
        if (voice) utterance.voice = voice;
        utterance.rate = 0.9;
        
        utterance.onend = () => { isSpeaking = false; };
        isSpeaking = true;
        window.speechSynthesis.speak(utterance);
    }

    // --- Recording Timer Logic ---
    let isRecording = false;
    let timerInterval;
    let seconds = 0;

    function toggleRecord() {
        const btn = document.getElementById('record-btn');
        const status = document.getElementById('rec-status');
        
        if (!isRecording) {
            // Start
            isRecording = true;
            btn.classList.add('recording');
            // Change icon to square (stop)
            btn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12"></rect></svg>';
            status.innerText = "RECORDING...";
            status.style.color = "#ef4444";
            
            timerInterval = setInterval(() => {
                seconds++;
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                document.getElementById('rec-timer').innerText = `${m}:${s.toString().padStart(2, '0')}`;
            }, 1000);

        } else {
            // Stop
            isRecording = false;
            clearInterval(timerInterval);
            seconds = 0;
            document.getElementById('rec-timer').innerText = "0:00";
            
            btn.classList.remove('recording');
            // Change icon back to mic
            btn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>';
            status.innerText = "READY TO RECORD";
            status.style.color = "#94a3b8";
        }
    }

    // Initialize
    updateUI();

</script>
</body>
</html><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energy Transformation Task</title>
    <style>
        /* --- OFFLINE CSS (Replaces Tailwind) --- */
        :root {
            --primary: #1e3a8a; /* Blue 900 */
            --primary-light: #2563eb;
            --secondary: #e2e8f0; /* Slate 200 */
            --text-dark: #1e293b;
            --text-light: #64748b;
            --bg-page: #f1f5f9;
            --bg-card: #ffffff;
            --danger: #ef4444;
            --success: #16a34a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-page);
            color: var(--text-dark);
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: var(--bg-card);
            border-radius: 16px;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-height: 600px;
        }

        /* Header */
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-title {
            font-size: 1.25rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-badge {
            background: rgba(255,255,255,0.2);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* Content Areas */
        .step-content {
            display: none; /* Hidden by default */
            padding: 40px;
            flex-grow: 1;
            overflow-y: auto;
            animation: fadeIn 0.5s ease-in;
        }

        .step-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Components */
        .card {
            background: #f8fafc;
            border: 2px solid var(--secondary);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        .btn-primary:hover { background-color: #1e40af; }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--text-dark);
        }
        .btn-secondary:hover { background-color: #cbd5e1; }

        .btn-listen {
            background-color: #eff6ff;
            color: var(--primary-light);
            border-radius: 50px;
            padding: 8px 16px;
            font-size: 0.9rem;
        }
        .btn-listen:hover { background-color: #dbeafe; }
        .btn-listen.playing { background-color: #fef3c7; color: #92400e; }

        /* Diagrams */
        svg { display: block; width: 100%; height: auto; max-height: 300px; }
        .diagram-box {
            background: #fff;
            border: 1px solid var(--secondary);
            border-radius: 8px;
            padding: 10px;
        }

        /* Form Inputs */
        input[type="text"], textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1rem;
            margin-top: 8px;
            box-sizing: border-box; /* Fix padding issues */
        }
        input:focus, textarea:focus {
            outline: 2px solid var(--primary-light);
            border-color: transparent;
        }

        /* Recording Area */
        .recording-area {
            margin-top: 20px;
            border-top: 1px solid var(--secondary);
            padding-top: 20px;
        }
        .rec-box {
            background: #f8fafc;
            border: 1px solid var(--secondary);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .rec-btn {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: none;
            background: var(--danger);
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .rec-btn.recording {
            background: #fee2e2;
            color: var(--danger);
            box-shadow: 0 0 0 4px #fee2e2;
        }
        .rec-status {
            font-family: monospace;
            font-weight: bold;
            font-size: 0.9rem;
            color: #94a3b8;
        }
        .rec-timer {
            font-family: monospace;
            font-size: 1.2rem;
            font-weight: bold;
        }

        /* Layout Grid */
        .grid-2 {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        @media (min-width: 768px) {
            .grid-2 { grid-template-columns: 1fr 1fr; }
        }

        /* Footer */
        footer {
            border-top: 1px solid var(--secondary);
            background: #f8fafc;
            padding: 20px;
            display: flex;
            justify-content: space-between;
        }

        /* Utility */
        .text-center { text-align: center; }
        .flex-col { display: flex; flex-direction: column; align-items: center; }
        .mb-4 { margin-bottom: 1rem; }
        .highlight-red { color: #dc2626; font-weight: bold; }
        .highlight-yellow { color: #d97706; font-weight: bold; }
        .highlight-blue { color: #2563eb; font-weight: bold; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="header-title">
            <div class="step-badge" id="step-badge-icon">âš¡</div>
            <span id="header-text">Energy Transformation</span>
        </div>
        <div style="opacity: 0.8; font-size: 0.9rem;">
            Page <span id="page-num">1</span> of 5
        </div>
    </header>

    <!-- STEP 0: TITLE -->
    <div id="step-0" class="step-content active">
        <div class="flex-col" style="padding-top: 40px;">
            <div style="background: var(--primary); color: white; padding: 20px; border-radius: 50%; margin-bottom: 20px;">
                <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon>
                </svg>
            </div>
            <h1 style="color: var(--primary); margin-bottom: 10px; font-size: 2.5rem;">Speaking Task</h1>
            <h2 style="color: var(--text-light); margin-top: 0;">Science: Energy Forms</h2>
            <p style="max-width: 400px; text-align: center; color: var(--text-light); line-height: 1.6;">
                In this activity, you will listen to a teacher and a student, look at diagrams, and then explain how energy works in a toaster.
            </p>
            <br>
            <button class="btn btn-primary" onclick="goToStep(1)">
                Start Activity &rarr;
            </button>
        </div>
    </div>

    <!-- STEP 1: CONTEXT -->
    <div id="step-1" class="step-content">
        <div class="card" style="background: #eff6ff; border-color: #bfdbfe;">
            <h3 class="highlight-blue">Introduction</h3>
            <p style="line-height: 1.6;">
                Mrs. Greenâ€™s class is learning about energy. They are learning that energy cannot be created or destroyed, but it can <strong>transform</strong> (change) from one form to another.
            </p>
            <button class="btn btn-listen" onclick="speak('Now we are going to talk about a science project. Mrs. Greenâ€™s class is learning about energy. They are learning that energy cannot be created or destroyed, but it can transformâ€”that means changeâ€”from one form to another.')">
                ðŸ”Š Listen to Introduction
            </button>
        </div>

        <div class="grid-2">
            <div class="card" style="display:flex; align-items:center; gap:15px;">
                <div style="background:#fef9c3; padding:10px; border-radius:50%;">âš¡</div>
                <div>
                    <strong>Key Concept</strong><br>
                    <span style="font-size:0.9rem; color: var(--text-light);">Energy changes form.</span>
                </div>
            </div>
            <div class="card" style="display:flex; align-items:center; gap:15px;">
                <div style="background:#fee2e2; padding:10px; border-radius:50%;">ðŸ”¥</div>
                <div>
                    <strong>Key Standard</strong><br>
                    <span style="font-size:0.9rem; color: var(--text-light);">Energy is not destroyed.</span>
                </div>
            </div>
        </div>
    </div>

    <!-- STEP 2: MODEL -->
    <div id="step-2" class="step-content">
        <div class="grid-2">
            <div class="diagram-box">
                <!-- Lamp SVG -->
                <svg viewBox="0 0 400 300">
                    <defs>
                        <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#dc2626" /></marker>
                    </defs>
                    <rect x="50" y="250" width="300" height="20" fill="#94a3b8" />
                    <path d="M10 260 Q 50 260, 150 250" stroke="#334155" strokeWidth="3" fill="none" />
                    <rect x="0" y="250" width="20" height="20" fill="#cbd5e1" rx="2" />
                    <path d="M130 250 L170 250 L160 200 L140 200 Z" fill="#1e3a8a" />
                    <rect x="145" y="100" width="10" height="100" fill="#1e3a8a" />
                    <path d="M110 100 L190 100 L210 150 L90 150 Z" fill="#fbbf24" opacity="0.8" />
                    <circle cx="150" cy="130" r="15" fill="#fef08a" />
                    <path d="M30 240 L80 240" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead)" />
                    <text x="35" y="230" fill="#dc2626" font-size="12" font-weight="bold">Electrical</text>
                    <path d="M170 110 L220 90" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead)" />
                    <path d="M180 130 L230 140" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead)" />
                    <text x="235" y="100" fill="#dc2626" font-size="12" font-weight="bold">Light & Heat</text>
                </svg>
                <p class="text-center" style="font-size:0.8rem; color:var(--text-light); margin-top:5px;">Figure 1: Desk Lamp</p>
            </div>

            <div>
                <div class="card" style="border-left: 4px solid var(--primary);">
                    <p class="highlight-blue">Teacher asks:</p>
                    <p style="font-style: italic; color: var(--text-light);">"Nina, explain to me step by step how the energy changes in the desk lamp."</p>
                    <button class="btn btn-listen" onclick="speak('Nina, explain to me step by step how the energy changes in the desk lamp.')">ðŸ”Š Listen</button>
                </div>

                <div class="card" style="border-left: 4px solid #d97706; background: #fffbeb;">
                    <p class="highlight-yellow">Nina answers:</p>
                    <p style="font-size:0.95rem;">"First, <span class="highlight-red">electrical energy</span> comes from the outlet... It changes into <span class="highlight-yellow">radiant energy</span> (light) and <span class="highlight-red">thermal energy</span> (heat)."</p>
                    <button class="btn btn-listen" onclick="speak('I can explain. The lamp needs energy to work. First, electrical energy comes from the outlet and travels through the cord. When the electricity reaches the lightbulb, it transforms. It changes into radiant energy, which is light, so we can read. It also changes into thermal energy, because the lightbulb gets hot.')">ðŸ”Š Listen to Nina</button>
                </div>
            </div>
        </div>
    </div>

    <!-- STEP 3: STUDENT TURN -->
    <div id="step-3" class="step-content">
        <div class="card" style="background:#eff6ff; border-color:#bfdbfe; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
            <div>
                <strong class="highlight-blue">Your Task</strong>
                <div style="font-size:0.9rem;">Explain how energy transforms in the toaster.</div>
            </div>
            <button class="btn btn-listen" onclick="speak('Now itâ€™s your turn. Look at the picture of the toaster. Explain to me step by step how the energy transforms in the toaster. Tell me what form it starts as, and what forms it turns into.')">ðŸ”Š Listen to Instructions</button>
        </div>

        <div class="grid-2">
            <div>
                <div class="diagram-box">
                    <!-- Toaster SVG -->
                    <svg viewBox="0 0 400 300">
                        <defs><marker id="arrowhead2" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#dc2626" /></marker></defs>
                        <rect x="50" y="250" width="300" height="20" fill="#94a3b8" />
                        <path d="M10 260 Q 50 260, 120 250" stroke="#334155" strokeWidth="3" fill="none" />
                        <rect x="0" y="250" width="20" height="20" fill="#cbd5e1" rx="2" />
                        <rect x="120" y="150" width="160" height="100" rx="10" fill="#94a3b8" stroke="#475569" strokeWidth="2" />
                        <rect x="140" y="150" width="20" height="80" fill="#cbd5e1" opacity="0.5" />
                        <rect x="180" y="150" width="20" height="80" fill="#cbd5e1" opacity="0.5" />
                        <rect x="220" y="150" width="20" height="80" fill="#cbd5e1" opacity="0.5" />
                        <path d="M130 160 L135 240 M150 160 L155 240" stroke="#ef4444" strokeWidth="2" opacity="0.8" />
                        <path d="M250 160 L255 240 M265 160 L270 240" stroke="#ef4444" strokeWidth="2" opacity="0.8" />
                        <path d="M150 110 L210 110 L205 150 L155 150 Z" fill="#d97706" stroke="#b45309" strokeWidth="2" />
                        <path d="M30 240 L80 240" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead2)" />
                        <text x="35" y="230" fill="#dc2626" font-size="12" font-weight="bold">Electrical</text>
                        <path d="M290 180 L340 160" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead2)" />
                        <text x="350" y="160" fill="#dc2626" font-size="18" font-weight="bold">?</text>
                        <path d="M290 220 L340 240" stroke="#dc2626" strokeWidth="2" markerEnd="url(#arrowhead2)" />
                        <text x="350" y="250" fill="#dc2626" font-size="18" font-weight="bold">?</text>
                    </svg>
                </div>
                <div class="card" style="margin-top:10px; background:#f1f5f9;">
                    <strong>Guiding Questions:</strong>
                    <ul style="margin:5px 0 0 20px; font-size:0.9rem;">
                        <li>What energy goes IN?</li>
                        <li>How does it change form?</li>
                        <li>What energy comes OUT?</li>
                    </ul>
                </div>
            </div>

            <div>
                <label style="font-size:0.9rem; font-weight:bold;">1. What starts the toaster?</label>
                <input type="text" placeholder="e.g. Electrical energy...">
                
                <br><br>

                <label style="font-size:0.9rem; font-weight:bold;">2. What forms does it turn into?</label>
                <textarea rows="3" placeholder="It changes into..."></textarea>

                <div class="recording-area">
                    <div style="font-size:0.8rem; font-weight:bold; color:var(--text-light); text-transform:uppercase; margin-bottom:5px;">Practice Speaking</div>
                    <div class="rec-box">
                        <button class="rec-btn" id="record-btn" onclick="toggleRecord()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                                <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                                <line x1="12" y1="19" x2="12" y2="23"></line>
                                <line x1="8" y1="23" x2="16" y2="23"></line>
                            </svg>
                        </button>
                        <div>
                            <div class="rec-status" id="rec-status">READY TO RECORD</div>
                            <div class="rec-timer" id="rec-timer">0:00</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- STEP 4: DONE -->
    <div id="step-4" class="step-content">
        <div class="flex-col" style="padding-top:40px;">
            <div style="background:#dcfce7; color:#16a34a; padding:20px; border-radius:50%; margin-bottom:20px;">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
            </div>
            <h1>Great Job!</h1>
            <p class="text-center" style="max-width:400px; color:var(--text-light);">
                You have explained how electrical energy transforms into thermal and radiant energy. Remember, energy is never destroyed, it just changes form!
            </p>
            <br>
            <button class="btn btn-secondary" onclick="goToStep(0)">Start Over</button>
        </div>
    </div>

    <footer id="footer-nav">
        <button class="btn btn-secondary" id="btn-back" onclick="changeStep(-1)" disabled>&larr; Back</button>
        <button class="btn btn-primary" id="btn-next" onclick="changeStep(1)">Next &rarr;</button>
    </footer>
</div>

<script>
    // --- VANILLA JAVASCRIPT LOGIC ---
    let currentStep = 0;
    const totalSteps = 5; // 0 to 4
    const titles = ["Energy Task", "The Classroom", "The Model", "Your Turn", "Complete"];

    function goToStep(stepIndex) {
        currentStep = stepIndex;
        updateUI();
    }

    function changeStep(delta) {
        const newStep = currentStep + delta;
        if (newStep >= 0 && newStep < totalSteps) {
            currentStep = newStep;
            updateUI();
        }
    }

    function updateUI() {
        // 1. Hide all steps
        document.querySelectorAll('.step-content').forEach(el => el.classList.remove('active'));
        
        // 2. Show current step
        document.getElementById(`step-${currentStep}`).classList.add('active');

        // 3. Update Header
        document.getElementById('header-text').innerText = titles[currentStep];
        document.getElementById('page-num').innerText = currentStep + 1;
        document.getElementById('step-badge-icon').innerText = currentStep === 0 ? 'âš¡' : currentStep;

        // 4. Update Footer Buttons
        const backBtn = document.getElementById('btn-back');
        const nextBtn = document.getElementById('btn-next');
        const footer = document.getElementById('footer-nav');

        if (currentStep === 0 || currentStep === 4) {
            footer.style.display = 'none'; // Hide nav on start/end screens
        } else {
            footer.style.display = 'flex';
            backBtn.disabled = (currentStep <= 1); // Disable back on first content page
            
            // Logic to disable Next on final page if needed, but we loop to end screen
            if (currentStep === 3) {
                nextBtn.innerHTML = 'Finish &rarr;';
            } else {
                nextBtn.innerHTML = 'Next &rarr;';
            }
        }
    }

    // --- Audio Logic ---
    let isSpeaking = false;
    function speak(text) {
        window.speechSynthesis.cancel(); // Stop previous
        if (isSpeaking) {
            isSpeaking = false;
            return;
        }

        const utterance = new SpeechSynthesisUtterance(text);
        // Try to get a female voice
        const voices = window.speechSynthesis.getVoices();
        const voice = voices.find(v => v.name.includes('Female') || v.name.includes('Google US English'));
        if (voice) utterance.voice = voice;
        utterance.rate = 0.9;
        
        utterance.onend = () => { isSpeaking = false; };
        isSpeaking = true;
        window.speechSynthesis.speak(utterance);
    }

    // --- Recording Timer Logic ---
    let isRecording = false;
    let timerInterval;
    let seconds = 0;

    function toggleRecord() {
        const btn = document.getElementById('record-btn');
        const status = document.getElementById('rec-status');
        
        if (!isRecording) {
            // Start
            isRecording = true;
            btn.classList.add('recording');
            // Change icon to square (stop)
            btn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12"></rect></svg>';
            status.innerText = "RECORDING...";
            status.style.color = "#ef4444";
            
            timerInterval = setInterval(() => {
                seconds++;
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                document.getElementById('rec-timer').innerText = `${m}:${s.toString().padStart(2, '0')}`;
            }, 1000);

        } else {
            // Stop
            isRecording = false;
            clearInterval(timerInterval);
            seconds = 0;
            document.getElementById('rec-timer').innerText = "0:00";
            
            btn.classList.remove('recording');
            // Change icon back to mic
            btn.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path><path d="M19 10v2a7 7 0 0 1-14 0v-2"></path><line x1="12" y1="19" x2="12" y2="23"></line><line x1="8" y1="23" x2="16" y2="23"></line></svg>';
            status.innerText = "READY TO RECORD";
            status.style.color = "#94a3b8";
        }
    }

    // Initialize
    updateUI();

</script>
</body>
</html>
